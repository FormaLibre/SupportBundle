{% macro sortUrl(orderedBy, order) %}
    {% if order == 'ASC' %}
        {% set newOrder = 'DESC' %}
    {% else %}
        {% set newOrder = 'ASC' %}
    {% endif %}

    {{ 
        path(
            'formalibre_support_index',
            {
                'orderedBy': orderedBy,
                'order': newOrder
            }
        )
    }}
{% endmacro %}

{% from _self import sortUrl %}

{% extends 'ClarolineCoreBundle:Desktop:layout.html.twig' %}

{% block title %}
    {{ 'formalibre_support_tool' | trans({}, 'tools') }}
{% endblock %}

{% block breadcrumb %}
    {{
        macros.desktopBreadcrumbs([
            {
                'name': 'formalibre_support_tool'|trans({}, 'tools'),
                'href': ''
            }
        ])
    }}
{% endblock %}

{% block content %}
    <div class="panel panel-default" id="support-tool">
        <div class="panel-heading">
            <h3 class="panel-title">
                {{ 'formalibre_support_tool'|trans({}, 'tools') }}
            </h3>
        </div>
        <div class="panel-body">
            {% if tickets|length > 0 %}
                <div class="table-responsive">
                    <table class="table">
                        <tr>
                            <th class="col-md-1">
                                <a href="{{ sortUrl('num', order) }}">
                                    #
                                </a>
                            </th>
                            <th class="col-md-4">
                                <a href="{{ sortUrl('title', order) }}">
                                    {{ 'title'|trans({}, 'platform') }}
                                </a>
                            </th>
                            <th class="col-md-2">
                                <a href="{{ sortUrl('status', order) }}">
                                    {{ 'status'|trans({}, 'platform') }}
                                </a>
                            </th>
                            <th class="col-md-2">
                                <a href="{{ sortUrl('priority', order) }}">
                                    {{ 'priority'|trans({}, 'support') }}
                                </a>
                            </th>
                            <th class="col-md-1">
                            </th>
                            <th class="col-md-1">
                            </th>
                            <th class="col-md-1">
                            </th>
                        </tr>
                        
                        {% for ticket in tickets %}
                            {% set ticketId = ticket.getId() %}
                            {% set ticketDescription = ticket.getDescription() %}
                            <tr id="row-ticket-{{ ticketId }}">
                                <td class="col-md-1">
                                    #{{ ticket.getNum() }}
                                </td>
                                <td class="col-md-4">
                                    <b class="pointer-hand"
                                       data-toggle="popover"
                                       data-container="body" 
                                       data-placement="right"
                                       data-content="{{ ticketDescription|raw }}"
                                    >
                                        {{ ticket.getTitle() }}
                                    </b>
                                    <p>
                                        {{ 'created_on'|trans({}, 'support') }}
                                        {{ ticket.getCreationDate()|intl_date_format }}
                                    </p>
                                </td>
                                <td class="col-md-2">
                                    {{ 'status'|trans({}, 'platform') }}:
                                    {{ ticket.getStatus() }}
                                    <p>
                                        [{{ ticket.getStatusDate()|intl_date_format }}]
                                    </p>
                                </td>
                                <td class="col-md-2">
                                    {{ 'priority'|trans({}, 'support') }}:
                                    {{ ticket.getPriority() }}
                                </td>
                                <td class="col-md-1">
                                    <i class="fa fa-comment-o"></i>
                                </td>
                                <td class="col-md-1">
                                    <i class="fa fa-clock-o"></i>
                                    {{ ticket.getSpentTime() }}
                                </td>
                                <td class="col-md-1">
                                    <a href="{{ path('formalibre_ticket_edit_form', {'ticket': ticketId}) }}"
                                       class="btn btn-sm btn-default"
                                    >
                                        <i class="fa fa-edit"></i>
                                    </a>
                                    <span class="btn btn-sm btn-danger delete-ticket-btn"
                                          data-ticket-id="{{ ticketId }}"
                                    >
                                        <i class="fa fa-trash"></i>
                                    </span>
                                </td>
                            </tr>
                        {% endfor %}
                    </table>
                </div>
            {% else %}
                <div class="alert alert-warning">
                    {{ 'no_ticket'|trans({}, 'support') }}
                </div>
            {% endif %}
            
            <a href="{{ path('formalibre_ticket_create_form') }}"
               class="btn btn-primary"
            >
                {{ 'create_ticket'|trans({}, 'support') }}
            </a>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript"
            src="{{ url('bazinga_jstranslation_js', { 'domain': 'support' }) }}"
    >
    </script>
    <script src='{{ asset('bundles/formalibresupport/js/supportIndex.js') }}'
            type="text/javascript"
    >
    </script>
{% endblock %}